<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard – Auditoria LAMIC</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #0b2545;
    --primary-light: #133b5c;
    --accent: #2563eb;
    --bg: #f3f4f6;
    --card-bg: #ffffff;
    --text: #1f2937;
    --text-light: #6b7280;
    --border: #e5e7eb;
    
    /* Cores de Status */
    --c-blue: #3b82f6;
    --c-green: #22c55e;
    --c-red: #ef4444;
    --c-orange: #f97316;
    --c-yellow: #eab308;
    --c-purple: #a855f7;
    --c-default: #6b7280;
    
    /* Indicadores de prazo */
    --ind-green: #22c55e;
    --ind-yellow: #eab308;
    --ind-red: #ef4444;
}

*{box-sizing:border-box}
body{margin:0;font-family:'Inter',sans-serif;display:flex;height:100vh;background:var(--bg);color:var(--text);overflow:hidden}

/* SIDEBAR */
.sidebar{width:260px;background:var(--primary);color:#fff;padding:32px 0;flex-shrink:0;display:flex;flex-direction:column}
.sidebar-logo{text-align:center;font-size:22px;font-weight:700;margin-bottom:40px;letter-spacing:-0.5px}
.sidebar button{width:100%;background:none;border:none;color:#cfd8e3;padding:16px 28px;text-align:left;font-size:15px;cursor:pointer;display:flex;gap:14px;align-items:center;transition:0.2s}
.sidebar button:hover{background:rgba(255,255,255,0.05);color:#fff}
.sidebar button.active{background:rgba(255,255,255,0.15);color:#fff;font-weight:600;border-right:4px solid var(--accent)}

.sidebar-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 8px 20px; }

/* MAIN LAYOUT */
.main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* HEADER */
.header{background:#fff;padding:20px 40px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;height:80px}
.title-area h1{margin:0;font-size:24px;font-weight:700;color:var(--primary)}
.title-area small{color:var(--text-light);font-size:14px}

.btn-primary{
    background:var(--primary-light);color:#fff;border:none;padding:12px 24px;border-radius:10px;
    font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:8px;
    transition:transform 0.1s, background 0.2s;box-shadow:0 4px 12px rgba(11,37,69,0.15)
}
.btn-primary:hover{background:var(--primary);transform:translateY(-1px)}
.btn-primary:active{transform:translateY(0)}

/* CONTENT AREA */
.content{flex:1;padding:30px 40px;overflow-y:auto;display:flex;flex-direction:column;gap:24px}

/* FILTERS BAR */
.filters-bar{
    background:#fff;padding:20px;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,0.03);
    display:flex;gap:16px;flex-wrap:wrap;align-items:center;border:1px solid var(--border);
    justify-content: space-between; /* Ajustado para mover o botão para a direita */
}
.filter-controls { display: flex; flex-wrap: wrap; gap: 16px; }
.filter-group{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.filter-input{
    padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-size:13px;
    color:var(--text);outline:none;background:#f9fafb;transition:0.2s;min-width:140px
}
.filter-input:focus{border-color:var(--primary-light);background:#fff;box-shadow:0 0 0 3px rgba(19,59,92,0.1)}

/* Date Filter Wrappers */
.date-controls { display: flex; gap: 8px; align-items: center; background: #f9fafb; padding: 4px; border: 1px solid var(--border); border-radius: 8px; }
.date-controls select, .date-controls input { border: 1px solid transparent; background: transparent; font-size: 13px; color: var(--text); padding: 5px; border-radius: 4px; outline: none; }
.date-controls select:hover, .date-controls input:hover { background: #e5e7eb; }
.date-controls input[type="date"] { font-family: inherit; }

.btn-clear{padding:8px 16px;background:transparent;border:1px solid var(--border);color:var(--text-light);border-radius:8px;cursor:pointer;font-size:13px}
.btn-clear:hover{background:#f3f4f6;color:var(--text)}

/* CARDS GRID (FIXED SIZE) */
.cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 296px);
    gap: 24px;
    justify-content: start;
    padding-bottom: 40px;
}

.card {
    background: #fff;
    width: 296px;
    border-radius: 16px;
    padding: 20px;
    position: relative;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 200px;
}
.card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }

/* Indicador lateral (Prazo) */
.card::before {
    content: ''; position: absolute; left: 0; top: 16px; bottom: 16px; width: 4px; border-radius: 0 4px 4px 0;
}
.card.ind-green::before { background: var(--ind-green); }
.card.ind-yellow::before { background: var(--ind-yellow); }
.card.ind-red::before { background: var(--ind-red); }

.card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: -10px; padding-left: 10px; }
.card-header h4 { margin: 0; font-size: 16px; font-weight: 600; color: var(--primary); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.card-actions { display: flex; gap: 8px; opacity: 0; transition: 0.2s; }
.card:hover .card-actions { opacity: 1; }
.card-actions i { font-size: 14px; color: var(--text-light); padding: 4px; border-radius: 4px; }
.card-actions i:hover { background: #f3f4f6; color: var(--primary); }

.card-body { padding-left: 10px; flex: 0.1; display: flex; flex-direction: column; gap: 4px; font-size: 13px; color: var(--text-light); }
.card-info-row { display: flex; align-items: center; gap: 8px; }
.card-info-row i { width: 16px; text-align: center; color: #9ca3af; }

/* Tag de Status com Cor */
.tag { 
    padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; 
    text-transform: uppercase; letter-spacing: 0.5px; width: fit-content; 
    color: #fff; /* Texto sempre branco */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* BACKUP VIEW */
#backupContent { display: none; flex-direction: column; gap: 30px; align-items: center; justify-content: center; height: 100%; text-align: center; }
.backup-card { background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid var(--border); width: 100%; max-width: 500px; }
.backup-actions { display: flex; gap: 20px; justify-content: center; margin-top: 24px; }
.btn-large { padding: 16px 32px; font-size: 16px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 10px; border: none; font-weight: 600; transition: 0.2s; }
.btn-export { background: var(--primary); color: #fff; }
.btn-export:hover { background: var(--primary-light); transform: translateY(-2px); }
.btn-import { background: #fff; color: var(--text); border: 2px solid var(--border); }
.btn-import:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }

/* MODAL FORM */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(2px);justify-content:center;align-items:center;z-index:1000}
.modal-content{background:#fff;padding:32px;border-radius:24px;width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}
.modal-header{margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--border)}
.modal-header h3{margin:0;color:var(--primary);font-size:20px}

.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.full-width{grid-column:1 / -1}

.field-group{display:flex;flex-direction:column;gap:6px}
.field-group label{font-size:12px;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:0.5px}
.field-group input, .field-group select, .field-group textarea{
    padding:12px;border-radius:10px;border:1px solid var(--border);font-family:inherit;font-size:14px;
    background:#fff;transition:0.2s;width:100%
}
.field-group input:focus, .field-group select:focus, .field-group textarea:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}

.select-wrapper{display:flex;gap:8px}
.select-wrapper button{padding:0 12px;background:var(--primary-light);color:#fff;border:none;border-radius:8px;cursor:pointer}

/* Botão Anexo */
.btn-add-anexo {
    width: 100%; padding: 12px; border: 2px dashed #cbd5e1; background: #f8fafc; color: var(--text-light);
    border-radius: 12px; font-weight: 500; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-add-anexo:hover { border-color: var(--accent); color: var(--accent); background: #eff6ff; }
.anexo-item { display: flex; align-items: center; gap: 8px; margin-top: 8px; padding: 8px; background: #f1f5f9; border-radius: 8px; font-size: 13px; }
.anexo-item input { border: none; background: transparent; padding: 4px; font-size: 13px; width: 100%; }

.modal-actions{display:flex;justify-content:flex-end;gap:12px;margin-top:32px;padding-top:20px;border-top:1px solid var(--border)}
.btn-cancel{background:#f3f4f6;color:var(--text);padding:12px 24px;border-radius:10px;border:none;font-weight:500;cursor:pointer}
.btn-save{background:var(--ind-green);color:#fff;padding:12px 24px;border-radius:10px;border:none;font-weight:500;cursor:pointer;box-shadow:0 4px 12px rgba(34,197,94,0.3)}

/* VIEW MODAL */
#viewContent { display: flex; flex-direction: column; gap: 24px; }
.view-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 16px; }
.view-status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; color: #fff; }
.view-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; background: #f9fafb; padding: 20px; border-radius: 16px; }
.view-item label { display: block; font-size: 11px; text-transform: uppercase; color: #9ca3af; font-weight: 600; margin-bottom: 4px; }
.view-item div { font-size: 15px; color: var(--primary); font-weight: 500; }
.view-desc { background: #fff; padding: 16px; border-radius: 12px; border: 1px solid var(--border); line-height: 1.6; color: #4b5563; }
.view-files h4 { font-size: 14px; margin: 0 0 12px; color: var(--primary); }
.file-chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #fff; border: 1px solid #bfdbfe; color: #1e40af; border-radius: 20px; font-size: 13px; text-decoration: none; font-weight: 500; transition:0.2s; cursor: pointer; }
.file-chip:hover { background: #eff6ff; }

/* List Manager */
.list-manager table { width: 100%; border-collapse: collapse; }
.list-manager td { padding: 12px 8px; border-bottom: 1px solid #f1f5f9; }
.list-manager .remove { color: var(--ind-red); cursor: pointer; text-align: right; }
.color-dot { width: 12px; height: 12px; border-radius: 4px; display: inline-block; margin-right: 8px; border: 1px solid rgba(0,0,0,0.1); }

/* Color Picker in Manager */
.color-picker { display: flex; gap: 10px; margin-top: 12px; justify-content: center; }
.color-option { width: 24px; height: 24px; border-radius: 6px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
.color-option:hover { transform: scale(1.1); }
.color-option.selected { border-color: var(--text); transform: scale(1.1); box-shadow: 0 0 0 2px rgba(0,0,0,0.1); }

/* Styles for specific colors */
.bg-blue { background-color: var(--c-blue); }
.bg-green { background-color: var(--c-green); }
.bg-red { background-color: var(--c-red); }
.bg-orange { background-color: var(--c-orange); }
.bg-yellow { background-color: var(--c-yellow); }
.bg-purple { background-color: var(--c-purple); }
.bg-default { background-color: var(--c-default); }

/* --- LOGIN & SECURITY STYLES --- */
#loginOverlay {
    position: fixed; inset: 0; background: rgba(255,255,255,0.4); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    display: flex; justify-content: center; align-items: center; z-index: 9999;
}
.login-box {
    background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    width: 100%; max-width: 400px; text-align: center; border: 1px solid var(--border);
}
.login-box h2 { margin-top: 0; color: var(--primary); margin-bottom: 10px; }
.login-box p { color: var(--text-light); margin-bottom: 24px; font-size: 14px; }
.login-input {
    width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 12px; font-size: 16px; margin-bottom: 16px;
    text-align: center; transition: 0.2s; outline: none;
}
.login-input:focus { border-color: var(--accent); }
.login-input.error { border-color: var(--c-red); color: var(--c-red); background: #fef2f2; }
.btn-login {
    width: 100%; padding: 14px; background: var(--primary); color: #fff; border: none; border-radius: 12px;
    font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s;
}
.btn-login:hover { background: var(--primary-light); }
.btn-login:disabled { background: var(--text-light); cursor: not-allowed; }

/* Shake Animation */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}
.shake { animation: shake 0.5s; }

#timerDisplay { margin-top: 10px; color: var(--c-red); font-weight: 700; font-size: 14px; min-height: 20px;}
#loadingText { margin-top: 15px; color: var(--accent); font-size: 13px; display: none; }
</style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box" id="loginBox">
        <i class="fa-solid fa-lock fa-3x" style="color:var(--primary); margin-bottom:16px;"></i>
        <h2>Acesso Restrito</h2>
        <p>Digite a senha mestra para acessar o dashboard.</p>
        
        <input type="password" id="passwordInput" class="login-input" placeholder="Senha" autofocus>
        <button class="btn-login" id="btnLogin" onclick="checkLogin()">Entrar</button>
        
        <div id="timerDisplay"></div>
        <div id="loadingText"><i class="fas fa-spinner fa-spin"></i> Conectando ao servidor...</div>
    </div>
</div>

<aside class="sidebar">
    <div class="sidebar-logo"><i class="fa-solid fa-layer-group"></i> Auditoria LAMIC</div>
    
    <button id="tabAuditoria" class="active"><i class="fa-solid fa-clipboard-check"></i> Auditoria</button>
    <button id="tabDocumentos"><i class="fa-solid fa-file-alt"></i> Documentos</button> 
    <button id="tabAtividades"><i class="fa-solid fa-list-check"></i> Gestão de Atividades</button>
    <button id="tabManutencao"><i class="fa-solid fa-wrench"></i> Manutenção</button>

    <div class="sidebar-divider"></div>

    <button id="tabBackup"><i class="fa-solid fa-database"></i> Backup</button>
</aside>

<div class="main-content">
    <header class="header">
        <div class="title-area">
            <h1 id="pageTitle">Auditoria</h1>
            <small id="pageSubtitle">Gerenciamento e agendamento</small>
        </div>
        </header>

    <div class="content">
        
        <div id="backupContent">
            <div class="backup-card">
                <i class="fa-solid fa-cloud-arrow-down fa-3x" style="color:var(--primary); margin-bottom:16px;"></i>
                <h2 style="margin:0 0 8px; color:var(--primary)">Central de Backup</h2>
                <p style="color:var(--text-light); margin:0 0 24px 0">Gerencie seus dados via Nuvem (JSONBin) ou Arquivo Local.</p>
                
                <div class="backup-actions" style="flex-wrap: wrap;">
                    <button class="btn-large btn-export" onclick="exportLocalData()" style="background:var(--ind-green); color:#fff; border:none; flex:1;">
                        <i class="fas fa-download"></i> Baixar Dados
                    </button>
                    <button class="btn-large btn-import" onclick="document.getElementById('fileInput').click()" style="background:#fff; color:var(--text); border:2px solid var(--border); flex:1;">
                        <i class="fas fa-upload"></i> Importar Dados
                    </button>
                    <input type="file" id="fileInput" style="display:none" onchange="importLocalData(this)" accept=".json">
                </div>
                <p style="font-size:12px; color:#999; margin-top:20px">Nota: Ao restaurar um arquivo local, ele será automaticamente sincronizado com a nuvem.</p>
            </div>
        </div>

        <div class="filters-bar" id="filtersBar">
            <div class="filter-controls">
                <div style="font-weight:600; color:var(--primary); font-size:14px;"><i class="fa-solid fa-filter"></i> Filtros:</div>
                
                <div id="filtersAuditoria" class="filter-group">
                    <select id="fAuditSetor" class="filter-input" onchange="onFilterSetorChange('Audit')">
                        <option value="">Setor: Todos</option>
                    </select>
                    <select id="fAuditCat" class="filter-input" onchange="onFilterCategoryChange('Audit')">
                        <option value="">Categoria: Todas</option>
                    </select>
                    <select id="fAuditSub" class="filter-input" onchange="renderCards()">
                        <option value="">Subcategoria: Todas</option>
                    </select>
                    <select id="fAuditStatus" class="filter-input" onchange="renderCards()">
                        <option value="">Status: Todos</option>
                    </select>
                    
                    <div class="date-controls">
                        <select id="fAuditDateType" onchange="updateDateInputs('Audit')">
                            <option value="all" selected>Período: Data</option>
                            <option value="month">Mês</option>
                            <option value="year">Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>
                        
                        <div id="fAuditGroupMonth" style="display:none; gap:4px">
                            <select id="fAuditMonth" onchange="renderCards()">
                                <option value="0">Jan</option><option value="1">Fev</option><option value="2">Mar</option>
                                <option value="3">Abr</option><option value="4">Mai</option><option value="5">Jun</option>
                                <option value="6">Jul</option><option value="7">Ago</option><option value="8">Set</option>
                                <option value="9">Out</option><option value="10">Nov</option><option value="11">Dez</option>
                            </select>
                            <select id="fAuditYearForMonth" onchange="renderCards()"></select>
                        </div>

                        <select id="fAuditYearOnly" style="display:none" onchange="renderCards()"></select>

                        <div id="fAuditGroupCustom" style="display:none; align-items:center; gap:4px">
                            <input type="date" id="fAuditDataIni" onchange="renderCards()">
                            <span style="color:#ccc">a</span>
                            <input type="date" id="fAuditDataFim" onchange="renderCards()">
                        </div>
                    </div>
                </div>

                <div id="filtersAtividades" class="filter-group" style="display:none;">
                    <select id="fAtivSetor" class="filter-input" onchange="onFilterSetorChange('Ativ')">
                        <option value="">Setor: Todos</option>
                    </select>
                    <select id="fAtivCat" class="filter-input" onchange="onFilterCategoryChange('Ativ')">
                        <option value="">Categoria: Todas</option>
                    </select>
                    <select id="fAtivSub" class="filter-input" onchange="renderCards()">
                        <option value="">Subcategoria: Todas</option>
                    </select>
                    <select id="fAtivStatus" class="filter-input" onchange="renderCards()">
                        <option value="">Status: Todos</option>
                    </select>
                    
                    <div class="date-controls">
                        <select id="fAtivDateType" onchange="updateDateInputs('Ativ')">
                            <option value="all" selected>Período: Data</option>
                            <option value="month">Mês</option>
                            <option value="year">Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>
                        
                        <div id="fAtivGroupMonth" style="display:none; gap:4px">
                            <select id="fAtivMonth" onchange="renderCards()">
                                <option value="0">Jan</option><option value="1">Fev</option><option value="2">Mar</option>
                                <option value="3">Abr</option><option value="4">Mai</option><option value="5">Jun</option>
                                <option value="6">Jul</option><option value="7">Ago</option><option value="8">Set</option>
                                <option value="9">Out</option><option value="10">Nov</option><option value="11">Dez</option>
                            </select>
                            <select id="fAtivYearForMonth" onchange="renderCards()"></select>
                        </div>

                        <select id="fAtivYearOnly" style="display:none" onchange="renderCards()"></select>

                        <div id="fAtivGroupCustom" style="display:none; align-items:center; gap:4px">
                            <input type="date" id="fAtivDataIni" onchange="renderCards()">
                            <span style="color:#ccc">a</span>
                            <input type="date" id="fAtivDataFim" onchange="renderCards()">
                        </div>
                    </div>
                </div>

                <div id="filtersManutencao" class="filter-group" style="display:none;">
                    <select id="fMantSetor" class="filter-input" onchange="onFilterSetorChange('Mant')">
                        <option value="">Setor: Todos</option>
                    </select>
                    <select id="fMantCat" class="filter-input" onchange="onFilterCategoryChange('Mant')">
                        <option value="">Categoria: Todas</option>
                    </select>
                    <select id="fMantItem" class="filter-input" onchange="renderCards()">
                        <option value="">Item: Todos</option>
                    </select>
                    <select id="fMantStatus" class="filter-input" onchange="renderCards()">
                        <option value="">Status: Todos</option>
                    </select>
                    
                    <div class="date-controls">
                        <select id="fMantDateType" onchange="updateDateInputs('Mant')">
                            <option value="all" selected>Próxima: Data</option>
                            <option value="month">Mês</option>
                            <option value="year">Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>

                        <div id="fMantGroupMonth" style="display:none; gap:4px">
                            <select id="fMantMonth" onchange="renderCards()">
                                <option value="0">Jan</option><option value="1">Fev</option><option value="2">Mar</option>
                                <option value="3">Abr</option><option value="4">Mai</option><option value="5">Jun</option>
                                <option value="6">Jul</option><option value="7">Ago</option><option value="8">Set</option>
                                <option value="9">Out</option><option value="10">Nov</option><option value="11">Dez</option>
                            </select>
                            <select id="fMantYearForMonth" onchange="renderCards()"></select>
                        </div>

                        <select id="fMantYearOnly" style="display:none" onchange="renderCards()"></select>

                        <div id="fMantGroupCustom" style="display:none; align-items:center; gap:4px">
                            <input type="date" id="fMantDataIni" onchange="renderCards()">
                            <span style="color:#ccc">a</span>
                            <input type="date" id="fMantDataFim" onchange="renderCards()">
                        </div>
                    </div>
                </div>

                <div id="filtersDocumentos" class="filter-group" style="display:none;"> 
                    <select id="fDocSetor" class="filter-input" onchange="onFilterSetorChange('Doc')">
                        <option value="">Setor: Todos</option>
                    </select>
                    <select id="fDocCat" class="filter-input" onchange="onFilterCategoryChange('Doc')">
                        <option value="">Categoria: Todas</option>
                    </select>
                    <select id="fDocSub" class="filter-input" onchange="renderCards()">
                        <option value="">Subcategoria: Todas</option>
                    </select>
                    <select id="fDocStatus" class="filter-input" onchange="renderCards()">
                        <option value="">Status: Todos</option>
                    </select>
                    
                    <div class="date-controls">
                        <select id="fDocDateType" onchange="updateDateInputs('Doc')">
                            <option value="all" selected>Data: Todas</option>
                            <option value="month">Mês</option>
                            <option value="year">Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>

                        <div id="fDocGroupMonth" style="display:none; gap:4px">
                            <select id="fDocMonth" onchange="renderCards()">
                                <option value="0">Jan</option><option value="1">Fev</option><option value="2">Mar</option>
                                <option value="3">Abr</option><option value="4">Mai</option><option value="5">Jun</option>
                                <option value="6">Jul</option><option value="7">Ago</option><option value="8">Set</option>
                                <option value="9">Out</option><option value="10">Nov</option><option value="11">Dez</option>
                            </select>
                            <select id="fDocYearForMonth" onchange="renderCards()"></select>
                        </div>

                        <select id="fDocYearOnly" style="display:none" onchange="renderCards()"></select>

                        <div id="fDocGroupCustom" style="display:none; align-items:center; gap:4px">
                            <input type="date" id="fDocDataIni" onchange="renderCards()">
                            <span style="color:#ccc">a</span>
                            <input type="date" id="fDocDataFim" onchange="renderCards()">
                        </div>
                    </div>
                </div>

                <button class="btn-clear" onclick="clearFilters()" title="Limpar filtros"><i class="fa-solid fa-rotate-left"></i></button>
            </div>
            
            <button class="btn-primary" id="addBtn"> <i class="fas fa-plus"></i> Novo Registro
            </button>
        </div>

        <div class="cards-grid" id="cardsGrid">
            </div>
    </div>
</div>

<div class="modal" id="modalAuditoria">
    <div class="modal-content">
        <div class="modal-header"><h3>Nova Auditoria</h3></div>
        <div class="form-grid">
            <div class="field-group full-width">
                <label>Título</label>
                <input id="auditTitulo" placeholder="Ex: Auditoria Interna ISO 9001">
            </div>
            <div class="field-group full-width">
                <label>Descrição</label>
                <textarea id="auditDescricao" rows="2"></textarea>
            </div>
            <div class="field-group">
                <label>Setor</label>
                <div class="select-wrapper">
                    <select id="auditSetor" onchange="onCategoryChange('audit')"></select>
                    <button onclick="openListManager('setores')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Categoria</label>
                <div class="select-wrapper">
                    <select id="auditCategoria" onchange="onCategoryChange('audit')"></select>
                    <button onclick="openListManager('categorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Subcategoria</label>
                <div class="select-wrapper">
                    <select id="auditSub"></select>
                    <button onclick="openListManager('subcategorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Status</label>
                <div class="select-wrapper">
                    <select id="auditStatus"></select>
                    <button onclick="openListManager('status')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Data Publicação</label>
                <input type="date" id="auditDataPublicacao">
            </div>
            <div class="field-group">
                <label>Data Previsão</label>
                <input type="date" id="auditDataPrevisao">
            </div>
            <div class="field-group">
                <label>Responsável</label> <input id="auditResponsavel" placeholder="Nome do Responsável">
            </div>
            <div class="field-group">
                <label>Alerta (Dias antes)</label>
                <input type="number" id="auditFlagDias" value="7">
            </div>
            <div class="field-group full-width">
                <label>Anexos</label>
                <div id="auditAnexos"></div>
                <button type="button" class="btn-add-anexo" onclick="addAnexo('audit')">
                    <i class="fas fa-paperclip"></i> Adicionar Arquivo ou Link
                </button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('modalAuditoria')">Cancelar</button>
            <button class="btn-save" onclick="saveAudit()">Salvar Registro</button>
        </div>
    </div>
</div>

<div class="modal" id="modalAtividades">
    <div class="modal-content">
        <div class="modal-header"><h3>Nova Atividade</h3></div>
        <div class="form-grid">
            <div class="field-group full-width">
                <label>Título</label>
                <input id="ativTitulo" placeholder="Ex: Treinamento de Segurança">
            </div>
            <div class="field-group full-width">
                <label>Descrição</label>
                <textarea id="ativDescricao" rows="2"></textarea>
            </div>
            <div class="field-group">
                <label>Setor</label>
                <div class="select-wrapper">
                    <select id="ativSetor" onchange="onCategoryChange('ativ')"></select>
                    <button onclick="openListManager('setores')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Categoria</label>
                <div class="select-wrapper">
                    <select id="ativCategoria" onchange="onCategoryChange('ativ')"></select>
                    <button onclick="openListManager('categorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Subcategoria</label>
                <div class="select-wrapper">
                    <select id="ativSub"></select>
                    <button onclick="openListManager('subcategorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Status</label>
                <div class="select-wrapper">
                    <select id="ativStatus"></select>
                    <button onclick="openListManager('status')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Data Início</label>
                <input type="date" id="ativDataInicio">
            </div>
            <div class="field-group">
                <label>Data Conclusão</label>
                <input type="date" id="ativDataConclusao">
            </div>
            <div class="field-group">
                <label>Responsável</label> <input id="ativResponsavel" placeholder="Nome do Responsável">
            </div>
            <div class="field-group">
                <label>Alerta (Dias antes)</label>
                <input type="number" id="ativFlagDias" value="3">
            </div>
            <div class="field-group full-width">
                <label>Anexos</label>
                <div id="ativAnexos"></div>
                <button type="button" class="btn-add-anexo" onclick="addAnexo('ativ')">
                    <i class="fas fa-paperclip"></i> Adicionar Arquivo ou Link
                </button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('modalAtividades')">Cancelar</button>
            <button class="btn-save" onclick="saveAtividade()">Salvar Registro</button>
        </div>
    </div>
</div>

<div class="modal" id="modalManutencao">
    <div class="modal-content">
        <div class="modal-header"><h3>Nova Manutenção</h3></div>
        <div class="form-grid">
            <div class="field-group full-width">
                <label>Título</label>
                <input id="mantTitulo" placeholder="Ex: Troca de filtros">
            </div>
            <div class="field-group full-width">
                <label>Descrição</label>
                <textarea id="mantDescricao" rows="2"></textarea>
            </div>
            <div class="field-group">
                <label>Setor</label>
                <div class="select-wrapper">
                    <select id="mantSetor" onchange="onCategoryChange('mant')"></select>
                    <button onclick="openListManager('setores')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Categoria</label>
                <div class="select-wrapper">
                    <select id="mantCategoria" onchange="onCategoryChange('mant')"></select>
                    <button onclick="openListManager('categorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Item / Equipamento</label>
                <div class="select-wrapper">
                    <select id="mantItem"></select>
                    <button onclick="openListManager('itens')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Última Manutenção</label>
                <input type="date" id="mantUltima" onchange="calculateNextDate('mant')">
            </div>
            <div class="field-group">
                <label>Periodicidade (Dias)</label>
                <input type="number" id="mantIntervalo" value="30" onchange="calculateNextDate('mant')">
            </div>
            <div class="field-group">
                <label>Responsável Técnico</label> <input id="mantResponsavelTecnico" placeholder="Nome do Técnico">
            </div>
            <div class="field-group">
                <label>Responsável pela Manutenção</label> <input id="mantResponsavelManutencao" placeholder="Nome do Gestor">
            </div>
            <div class="field-group full-width" style="background:#f0f9ff; padding:10px; border-radius:8px; border:1px solid #bae6fd">
                <label style="color:#0369a1">Próxima Manutenção (Calculada)</label>
                <div id="mantProxima" style="font-size:16px; font-weight:700; color:#0c4a6e; margin-top:4px">--/--/----</div>
            </div>
            <div class="field-group">
                <label>Status</label>
                <div class="select-wrapper">
                    <select id="mantStatus"></select>
                    <button onclick="openListManager('status')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Alerta (Dias)</label>
                <input type="number" id="mantFlagDias" value="7">
            </div>
            <div class="field-group full-width">
                <label>Anexos</label>
                <div id="mantAnexos"></div>
                <button type="button" class="btn-add-anexo" onclick="addAnexo('mant')">
                    <i class="fas fa-paperclip"></i> Adicionar Arquivo ou Link
                </button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('modalManutencao')">Cancelar</button>
            <button class="btn-save" onclick="saveManutencao()">Salvar Registro</button>
        </div>
    </div>
</div>

<div class="modal" id="modalDocumentos"> <div class="modal-content">
        <div class="modal-header"><h3>Novo Documento</h3></div>
        <div class="form-grid">
            <div class="field-group full-width">
                <label>Título/Nome do Documento</label>
                <input id="docTitulo" placeholder="Ex: Procedimento Operacional Padrão 01">
            </div>
            <div class="field-group full-width">
                <label>Descrição/Resumo</label>
                <textarea id="docDescricao" rows="2"></textarea>
            </div>
            <div class="field-group">
                <label>Setor</label>
                <div class="select-wrapper">
                    <select id="docSetor" onchange="onCategoryChange('doc')"></select>
                    <button onclick="openListManager('setores')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Categoria</label>
                <div class="select-wrapper">
                    <select id="docCategoria" onchange="onCategoryChange('doc')"></select>
                    <button onclick="openListManager('categorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Subcategoria</label>
                <div class="select-wrapper">
                    <select id="docSub"></select>
                    <button onclick="openListManager('subcategorias')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Status</label>
                <div class="select-wrapper">
                    <select id="docStatus"></select>
                    <button onclick="openListManager('status')"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="field-group">
                <label>Data de Criação</label>
                <input type="date" id="docDataCriacao" onchange="calculateNextDate('doc')">
            </div>
            <div class="field-group">
                <label>Periodicidade (Dias)</label>
                <input type="number" id="docIntervalo" value="365" onchange="calculateNextDate('doc')">
            </div>
            <div class="field-group full-width" style="background:#f0f9ff; padding:10px; border-radius:8px; border:1px solid #bae6fd">
                <label style="color:#0369a1">Próxima Revisão (Calculada)</label>
                <div id="docProximaRevisao" style="font-size:16px; font-weight:700; color:#0c4a6e; margin-top:4px">--/--/----</div>
            </div>
            <div class="field-group">
                <label>Responsável</label>
                <input id="docResponsavel" placeholder="Responsável pela elaboração">
            </div>
            <div class="field-group">
                <label>Revisor/Aprovador</label>
                <input id="docRevisor" placeholder="Revisor ou Aprovador">
            </div>
            <div class="field-group">
                <label>Alerta (Dias antes da revisão)</label>
                <input type="number" id="docFlagDias" value="30">
            </div>
            <div class="field-group full-width">
                <label>Anexos (Link para o documento)</label>
                <div id="docAnexos"></div>
                <button type="button" class="btn-add-anexo" onclick="addAnexo('doc')">
                    <i class="fas fa-paperclip"></i> Adicionar Link
                </button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('modalDocumentos')">Cancelar</button>
            <button class="btn-save" onclick="saveDocumento()">Salvar Registro</button>
        </div>
    </div>
</div>

<div class="modal" id="viewModal">
    <div class="modal-content">
        <div id="viewContent"></div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('viewModal')">Fechar</button>
        </div>
    </div>
</div>

<div class="modal" id="modalListManager">
    <div class="modal-content" style="width:400px">
        <h3 id="listTitle" style="margin-bottom:16px">Gerenciar</h3>
        
        <div class="field-group">
            <input id="newListItem" placeholder="Nome..." style="width:100%">
        </div>
        
        <div id="colorPickerContainer" style="display:none; text-align:center; padding:10px 0;">
            <label style="display:block; font-size:11px; margin-bottom:8px; color:#6b7280; font-weight:600">Selecione a Cor</label>
            <div class="color-picker">
                <div class="color-option bg-blue" onclick="selectColor('blue', this)"></div>
                <div class="color-option bg-green" onclick="selectColor('green', this)"></div>
                <div class="color-option bg-red" onclick="selectColor('red', this)"></div>
                <div class="color-option bg-orange" onclick="selectColor('orange', this)"></div>
                <div class="color-option bg-yellow" onclick="selectColor('yellow', this)"></div>
                <div class="color-option bg-purple" onclick="selectColor('purple', this)"></div>
                <div class="color-option bg-default selected" onclick="selectColor('default', this)"></div>
            </div>
        </div>

        <button onclick="addToList()" class="btn-primary" style="width:100%; margin-top:12px; justify-content:center">Adicionar</button>

        <div class="list-manager" style="margin-top:16px; max-height:300px; overflow-y:auto">
            <table>
                <tbody id="listBody"></tbody>
            </table>
        </div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal('modalListManager')">Concluir</button>
        </div>
    </div>
</div>

<script>
// --- CONFIGURAÇÃO JSONBIN E SEGURANÇA ---
const API_KEY = '$2a$10$2elKW8TT6o.K3V176efqwu7kOfD1PnS3D/F0s4Tczc3MYmaU.N1bi';
const DATA_BIN_ID = '693d73c4ae596e708f976cf4';
const PASSWORD_BIN_ID = '68d7e57bd0ea881f408cf33b';

let failedAttempts = 0;
let lockoutTimer = null;

// --- DADOS E ESTADO (Iniciam vazios) ---
let audits = [];
let activities = [];
let maintenances = [];
let documents = []; 

const defaultMasterLists = {
    // Listas Principais (Limpas)
    setores: [], // NOVO: Setores (Aplicável a todas as abas)
    auditCategorias: [],
    ativCategorias: [],
    mantCategorias: [],
    docCategorias: [], 

    // Listas de Subcategorias/Itens (Limpas)
    auditSubcats: {},
    ativSubcats: {},
    mantItens: {},
    docSubcats: {},

    // Listas de Status (Limpas, mantendo apenas a estrutura)
    auditStatus: [
        { name: 'Planejado', color: 'blue' },
        { name: 'Em Andamento', color: 'yellow' },
        { name: 'Concluído', color: 'green' },
        { name: 'Atrasado', color: 'red' }
    ],
    ativStatus: [
        { name: 'A Fazer', color: 'default' },
        { name: 'Em Progresso', color: 'blue' },
        { name: 'Concluído', color: 'green' },
        { name: 'Cancelado', color: 'red' }
    ],
    mantStatus: [
        { name: 'Aguardando Peça', color: 'orange' },
        { name: 'Agendado', color: 'blue' },
        { name: 'Em Execução', color: 'yellow' },
        { name: 'Finalizado', color: 'green' }
    ],
    docStatus: [ 
        { name: 'Rascunho', color: 'default' },
        { name: 'Em Revisão', color: 'blue' },
        { name: 'Publicado', color: 'green' },
        { name: 'Obsoleto', color: 'red' }
    ]
};

let masterLists = JSON.parse(JSON.stringify(defaultMasterLists)); // Clone inicial

let currentTab = 'auditoria';
let editingAuditId = null;
let editingAtivId = null;
let editingMantId = null;
let editingDocId = null; 
let currentListKey = null; 
let selectedColorTemp = 'default';

// --- UTILITÁRIOS ---
const today = () => new Date().toISOString().split('T')[0];
const currentYear = new Date().getFullYear();
const currentMonth = new Date().getMonth();
const formatBR = dateStr => {
    if (!dateStr) return 'ND';
    const [y, m, d] = dateStr.split('-');
    return `${d}/${m}/${y}`;
};
const daysDiff = dateStr => Math.ceil((new Date(dateStr) - new Date()) / (1000*60*60*24));

const colorMap = {
    'blue': 'var(--c-blue)',
    'green': 'var(--c-green)',
    'red': 'var(--c-red)',
    'orange': 'var(--c-orange)',
    'yellow': 'var(--c-yellow)',
    'purple': 'var(--c-purple)',
    'default': 'var(--c-default)'
};

// --- LÓGICA DE LOGIN ---
document.getElementById('passwordInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') checkLogin();
});

async function checkLogin() {
    const input = document.getElementById('passwordInput');
    const btn = document.getElementById('btnLogin');
    const loading = document.getElementById('loadingText');
    const loginBox = document.getElementById('loginBox');
    const timerDisplay = document.getElementById('timerDisplay');
    
    if(btn.disabled) return;

    const userPass = input.value;
    if(!userPass) return;

    btn.disabled = true;
    input.disabled = true;
    loading.style.display = 'block';

    try {
        // Buscar Senha no Bin
        const res = await fetch(`https://api.jsonbin.io/v3/b/${PASSWORD_BIN_ID}/latest`, {
            headers: { 'X-Master-Key': API_KEY }
        });
        
        if(!res.ok) throw new Error('Erro ao verificar senha');
        
        const data = await res.json();
        // Assume que o bin retorna { record: { password: "123" } } ou { record: "123" }
        const remotePass = data.record.password || data.record;

        if (String(userPass) === String(remotePass)) {
            // Sucesso
            loading.innerHTML = '<i class="fas fa-check"></i> Senha correta. Carregando dados...';
            await loadCloudData();
            document.getElementById('loginOverlay').style.display = 'none';
        } else {
            // Senha Errada
            handleLoginError(input, btn, loginBox);
        }

    } catch (err) {
        alert("Erro de conexão: " + err.message);
        btn.disabled = false;
        input.disabled = false;
        input.focus();
    } finally {
        loading.style.display = 'none';
    }
}

function handleLoginError(input, btn, box) {
    failedAttempts++;
    input.classList.add('error');
    box.classList.add('shake');
    
    setTimeout(() => {
        box.classList.remove('shake');
        input.classList.remove('error');
    }, 500);

    if (failedAttempts >= 5) {
        let seconds = 10;
        const timerDisplay = document.getElementById('timerDisplay');
        timerDisplay.textContent = `Muitas tentativas. Aguarde ${seconds}s`;
        
        const interval = setInterval(() => {
            seconds--;
            timerDisplay.textContent = `Muitas tentativas. Aguarde ${seconds}s`;
            if (seconds <= 0) {
                clearInterval(interval);
                timerDisplay.textContent = "";
                failedAttempts = 0;
                input.disabled = false;
                btn.disabled = false;
                input.value = "";
                input.focus();
            }
        }, 1000);
    } else {
        input.disabled = false;
        btn.disabled = false;
        input.value = "";
        input.focus();
    }
}

// --- INTEGRAÇÃO JSONBIN (DATA) ---

async function loadCloudData() {
    try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${DATA_BIN_ID}/latest`, {
            headers: { 'X-Master-Key': API_KEY }
        });
        if(!res.ok) throw new Error('Erro ao baixar dados');
        
        const data = await res.json();
        const record = data.record;

        audits = record.audits || [];
        activities = record.activities || [];
        maintenances = record.maintenances || [];
        documents = record.documents || []; 
        
        if (record.masterLists) {
            // Fusão de listas mestre para garantir que todos os tipos de subcategorias existam se o bin for mais antigo
            masterLists = { ...defaultMasterLists, ...record.masterLists };
            
            // Corrige a compatibilidade de mantItens se o formato antigo for detectado (se o item for um array e não um objeto)
            if (Array.isArray(masterLists.mantItens)) {
                masterLists.mantItens = defaultMasterLists.mantItens; 
            }
        }

        // Inicializa a UI após carregar
        populateYearSelects();
        populateSelects();
        updateDateInputs('Audit');
        updateDateInputs('Ativ');
        updateDateInputs('Mant');
        updateDateInputs('Doc'); 
        renderCards();

    } catch (err) {
        alert("Falha ao carregar dados do Cloud: " + err.message);
        // Fallback para arrays vazios já inicializados
    }
}

async function saveAll(showAlert = false) {
    const payload = {
        audits,
        activities,
        maintenances,
        documents, 
        masterLists,
        lastUpdate: new Date().toISOString()
    };

    try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${DATA_BIN_ID}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': API_KEY
            },
            body: JSON.stringify(payload)
        });

        if(!res.ok) throw new Error('Erro na API');
        if(showAlert) alert("Dados sincronizados com sucesso!");
        
    } catch (err) {
        console.error("Erro ao salvar:", err);
        if(showAlert) alert("Erro ao salvar dados: " + err.message);
    }
}

// --- CONFIGURAÇÃO DE DATAS ---
function populateYearSelects() {
    const years = [];
    for(let i = currentYear - 4; i <= currentYear + 1; i++) {
        years.push(i);
    }
    const options = years.map(y => `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`).join('');
    
    ['fAuditYearForMonth', 'fAuditYearOnly', 'fAtivYearForMonth', 'fAtivYearOnly', 'fMantYearForMonth', 'fMantYearOnly', 'fDocYearForMonth', 'fDocYearOnly'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.innerHTML = options;
    });

    ['fAuditMonth', 'fAtivMonth', 'fMantMonth', 'fDocMonth'].forEach(id => {
        document.getElementById(id).value = currentMonth;
    });
}

function updateDateInputs(prefix) {
    const type = document.getElementById(`f${prefix}DateType`).value;
    document.getElementById(`f${prefix}GroupMonth`).style.display = type === 'month' ? 'flex' : 'none';
    document.getElementById(`f${prefix}YearOnly`).style.display = type === 'year' ? 'block' : 'none';
    document.getElementById(`f${prefix}GroupCustom`).style.display = type === 'custom' ? 'flex' : 'none';
    renderCards();
}

// --- RENDERIZAÇÃO DE CARDS E FILTROS ---
function renderCards() {
    if(currentTab === 'backup') return; 

    const grid = document.getElementById('cardsGrid');
    grid.innerHTML = '';
    
    let data = [];
    let statusList = [];
    let dateField = '';
    let filterCatId = '';
    let filterSubcatId = '';

    if (currentTab === 'auditoria') {
        statusList = masterLists.auditStatus || [];
        dateField = 'dataPrevisao';
        filterSetorId = 'fAuditSetor'; // NOVO
        filterCatId = 'fAuditCat';
        filterSubcatId = 'fAuditSub';
        
        const setor = document.getElementById(filterSetorId).value; // NOVO
        const cat = document.getElementById(filterCatId).value;
        const sub = document.getElementById(filterSubcatId).value;
        const stat = document.getElementById('fAuditStatus').value;
        const dateType = document.getElementById('fAuditDateType').value;
        
        data = audits.filter(item => {
            if (setor && item.setor !== setor) return false; // NOVO FILTRO
            if (cat && item.categoria !== cat) return false;
            if (sub && item.subcategoria !== sub) return false;
            if (stat && item.status !== stat) return false;
            
            if (dateType !== 'all') {
                const itemDate = new Date(item[dateField]);
                // Lógica de filtro de data... (não alterada, apenas movida para manter o código limpo)
                if (dateType === 'month') {
                    if (itemDate.getMonth() !== parseInt(document.getElementById('fAuditMonth').value) || 
                        itemDate.getFullYear() !== parseInt(document.getElementById('fAuditYearForMonth').value)) return false;
                } else if (dateType === 'year') {
                    if (itemDate.getFullYear() !== parseInt(document.getElementById('fAuditYearOnly').value)) return false;
                } else if (dateType === 'custom') {
                    const ini = document.getElementById('fAuditDataIni').value;
                    const fim = document.getElementById('fAuditDataFim').value;
                    if (ini && item[dateField] < ini) return false;
                    if (fim && item[dateField] > fim) return false;
                }
            }
            return true;
        });
        
    } else if (currentTab === 'atividades') {
        statusList = masterLists.ativStatus || [];
        dateField = 'dataConclusao';
        filterSetorId = 'fAtivSetor'; // NOVO
        filterCatId = 'fAtivCat';
        filterSubcatId = 'fAtivSub';

        const setor = document.getElementById(filterSetorId).value; // NOVO
        const cat = document.getElementById(filterCatId).value;
        const sub = document.getElementById(filterSubcatId).value;
        const stat = document.getElementById('fAtivStatus').value;
        const dateType = document.getElementById('fAtivDateType').value;

        data = activities.filter(item => {
            if (setor && item.setor !== setor) return false; // NOVO FILTRO
            if (cat && item.categoria !== cat) return false;
            if (sub && item.subcategoria !== sub) return false;
            if (stat && item.status !== stat) return false;

            if (dateType !== 'all') {
                const itemDate = new Date(item[dateField]);
                if (dateType === 'month') {
                    if (itemDate.getMonth() !== parseInt(document.getElementById('fAtivMonth').value) || 
                        itemDate.getFullYear() !== parseInt(document.getElementById('fAtivYearForMonth').value)) return false;
                } else if (dateType === 'year') {
                    if (itemDate.getFullYear() !== parseInt(document.getElementById('fAtivYearOnly').value)) return false;
                } else if (dateType === 'custom') {
                    const ini = document.getElementById('fAtivDataIni').value;
                    const fim = document.getElementById('fAtivDataFim').value;
                    if (ini && item[dateField] < ini) return false;
                    if (fim && item[dateField] > fim) return false;
                }
            }
            return true;
        });

    } else if (currentTab === 'manutencao') {
        statusList = masterLists.mantStatus || [];
        dateField = 'proxima';
        filterSetorId = 'fMantSetor'; // NOVO
        filterCatId = 'fMantCat';
        filterSubcatId = 'fMantItem'; // Item de manutenção age como a subcategoria

        const setor = document.getElementById(filterSetorId).value; // NOVO
        const cat = document.getElementById(filterCatId).value;
        const itemVal = document.getElementById(filterSubcatId).value;
        const stat = document.getElementById('fMantStatus').value;
        const dateType = document.getElementById('fMantDateType').value;

        data = maintenances.filter(item => {
            if (setor && item.setor !== setor) return false; // NOVO FILTRO
            if (cat && item.categoria !== cat) return false;
            if (itemVal && item.item !== itemVal) return false;
            if (stat && item.status !== stat) return false;

            if (dateType !== 'all') {
                const itemDate = new Date(item[dateField]);
                if (dateType === 'month') {
                    if (itemDate.getMonth() !== parseInt(document.getElementById('fMantMonth').value) || 
                        itemDate.getFullYear() !== parseInt(document.getElementById('fMantYearForMonth').value)) return false;
                } else if (dateType === 'year') {
                    if (itemDate.getFullYear() !== parseInt(document.getElementById('fMantYearOnly').value)) return false;
                } else if (dateType === 'custom') {
                    const ini = document.getElementById('fMantDataIni').value;
                    const fim = document.getElementById('fMantDataFim').value;
                    if (ini && item[dateField] < ini) return false;
                    if (fim && item[dateField] > fim) return false;
                }
            }
            return true;
        });
    } else if (currentTab === 'documentos') { 
        statusList = masterLists.docStatus || [];
        dateField = 'dataProximaRevisao'; // NOVO CAMPO
        filterSetorId = 'fDocSetor'; // NOVO
        filterCatId = 'fDocCat';
        filterSubcatId = 'fDocSub';

        const setor = document.getElementById(filterSetorId).value; // NOVO
        const cat = document.getElementById(filterCatId).value;
        const sub = document.getElementById(filterSubcatId).value;
        const stat = document.getElementById('fDocStatus').value;
        const dateType = document.getElementById('fDocDateType').value;

        data = documents.filter(item => {
            if (setor && item.setor !== setor) return false; // NOVO FILTRO
            if (cat && item.categoria !== cat) return false;
            if (sub && item.subcategoria !== sub) return false;
            if (stat && item.status !== stat) return false;

            if (dateType !== 'all') {
                const itemDate = new Date(item[dateField]);
                if (dateType === 'month') {
                    if (itemDate.getMonth() !== parseInt(document.getElementById('fDocMonth').value) || 
                        itemDate.getFullYear() !== parseInt(document.getElementById('fDocYearForMonth').value)) return false;
                } else if (dateType === 'year') {
                    if (itemDate.getFullYear() !== parseInt(document.getElementById('fDocYearOnly').value)) return false;
                } else if (dateType === 'custom') {
                    const ini = document.getElementById('fDocDataIni').value;
                    const fim = document.getElementById('fDocDataFim').value;
                    if (ini && item[dateField] < ini) return false;
                    if (fim && item[dateField] > fim) return false;
                }
            }
            return true;
        });
    }


    // ORDENAÇÃO (SOLICITAÇÃO)
    if (dateField) {
        data.sort((a, b) => {
            const dateA = new Date(a[dateField]);
            const dateB = new Date(b[dateField]);
            // Ordena do mais antigo para o mais novo (menor para o maior)
            return dateA - dateB;
        });
    }

    if(data.length === 0) {
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px; color:#9ca3af"><i class="fas fa-search fa-2x"></i><p>Nenhum registro encontrado.</p></div>';
        return;
    }

    data.forEach(item => {
        const div = document.createElement('div');
        const flagDays = item.flagDias || 7;
        let targetDate;
        
        if (currentTab === 'auditoria') targetDate = item.dataPrevisao;
        else if (currentTab === 'atividades') targetDate = item.dataConclusao;
        else if (currentTab === 'manutencao') targetDate = item.proxima;
        else targetDate = item.dataProximaRevisao; // Documentos (NOVO CAMPO)

        const d = daysDiff(targetDate);
        
        let indicatorClass = 'ind-green';
        if (d < 0) indicatorClass = 'ind-red';
        else if (d <= flagDays) indicatorClass = 'ind-yellow';

        const statusObj = statusList.find(s => s.name === item.status) || { color: 'default' };
        const statusColorVar = colorMap[statusObj.color] || colorMap['default'];

        div.className = `card ${indicatorClass}`;
        div.onclick = () => openView(item.id, currentTab);

        let specificContent = '';
        const subcatOrItemValue = currentTab === 'manutencao' ? item.item : item.subcategoria;
        const subcategoryDisplay = subcatOrItemValue ? ` (${subcatOrItemValue})` : '';

        if (currentTab === 'auditoria') {
            specificContent = `
                <div class="card-info-row"><i class="fas fa-building"></i> <span>${item.setor || 'ND'}</span></div>
                <div class="card-info-row"><i class="far fa-folder"></i> <span>${item.categoria || '-'} ${subcategoryDisplay}</span></div>
                <div class="card-info-row"><i class="far fa-calendar-check"></i> <span>Prev: <strong>${formatBR(item.dataPrevisao)}</strong></span></div>
            `;
        } else if (currentTab === 'atividades') {
            specificContent = `
                <div class="card-info-row"><i class="fas fa-building"></i> <span>${item.setor || 'ND'}</span></div>
                <div class="card-info-row"><i class="far fa-folder"></i> <span>${item.categoria || '-'} ${subcategoryDisplay}</span></div>
                <div class="card-info-row"><i class="far fa-calendar-check"></i> <span>Fim: <strong>${formatBR(item.dataConclusao)}</strong></span></div>
            `;
        } else if (currentTab === 'manutencao') {
            specificContent = `
                <div class="card-info-row"><i class="fas fa-building"></i> <span>${item.setor || 'ND'}</span></div>
                <div class="card-info-row"><i class="far fa-folder"></i> <span>${item.categoria || '-'}</span></div>
                <div class="card-info-row"><i class="far fa-clock"></i> <span>Próx: <strong>${formatBR(item.proxima)}</strong></span></div>
            `;
        } else { // Documentos
            specificContent = `
                <div class="card-info-row"><i class="fas fa-building"></i> <span>${item.setor || 'ND'}</span></div>
                <div class="card-info-row"><i class="far fa-folder"></i> <span>${item.categoria || '-'} ${subcategoryDisplay}</span></div>
                <div class="card-info-row"><i class="far fa-calendar-check"></i> <span>Rev: <strong>${formatBR(item.dataProximaRevisao)}</strong></span></div>
            `;
        }

        div.innerHTML = `
            <div class="card-header">
                <span class="tag" style="background-color:${statusColorVar}">${item.status || 'Novo'}</span>
                <div class="card-actions" onclick="event.stopPropagation()">
                    <i class="fas fa-pen" onclick="editItem(${item.id}, '${currentTab}')" title="Editar"></i>
                    <i class="fas fa-trash" onclick="deleteItem(${item.id}, '${currentTab}')" title="Excluir"></i>
                </div>
            </div>
            <div style="padding:0 10px; margin-bottom:12px;">
                <h4 title="${item.titulo}">${item.titulo}</h4>
            </div>
            <div class="card-body">
                ${specificContent}
            </div>
        `;
        grid.appendChild(div);
    });
}

function clearFilters() {
    document.querySelectorAll('.filters-bar select').forEach(s => {
        if(!s.id.includes('DateType') && !s.id.includes('Month') && !s.id.includes('Year')) s.value = "";
    });
    
    document.getElementById('fAuditDateType').value = 'all';
    document.getElementById('fAtivDateType').value = 'all';
    document.getElementById('fMantDateType').value = 'all';
    document.getElementById('fDocDateType').value = 'all'; 
    
    document.querySelectorAll('.filters-bar input').forEach(i => i.value = "");
    
    updateDateInputs('Audit');
    updateDateInputs('Ativ');
    updateDateInputs('Mant');
    updateDateInputs('Doc'); 
    
    // Recarrega os filtros em cascata após limpar
    onFilterSetorChange('Audit');
    onFilterSetorChange('Ativ');
    onFilterSetorChange('Mant');
    onFilterSetorChange('Doc');
}


function populateSelects() {
    // Listas de Setores, Categorias e Status
    const setores = masterLists.setores || []; // NOVO
    const auditCats = masterLists.auditCategorias || [];
    const auditStats = masterLists.auditStatus || [];
    const ativCats = masterLists.ativCategorias || [];
    const ativStats = masterLists.ativStatus || [];
    const mantCats = masterLists.mantCategorias || [];
    const mantStats = masterLists.mantStatus || [];
    const docCats = masterLists.docCategorias || [];
    const docStats = masterLists.docStatus || [];

    // Funções auxiliares para gerar <option>
    const makeOpts = (list) => list.map(i => `<option>${i}</option>`).join('');
    const makeStatusOpts = (list) => list.map(i => `<option value="${i.name}">${i.name}</option>`).join('');
    const makeFilterOpts = (list, label) => `<option value="">${label}</option>` + list.map(i => `<option value="${i}">${i}</option>`).join('');
    const makeStatusFilterOpts = (list, label) => `<option value="">${label}</option>` + list.map(i => `<option value="${i.name}">${i.name}</option>`).join('');

    // --- MODAIS ---
    // Setores
    document.getElementById('auditSetor').innerHTML = makeOpts(setores); // NOVO
    document.getElementById('ativSetor').innerHTML = makeOpts(setores); // NOVO
    document.getElementById('mantSetor').innerHTML = makeOpts(setores); // NOVO
    document.getElementById('docSetor').innerHTML = makeOpts(setores); // NOVO

    // Auditoria
    document.getElementById('auditCategoria').innerHTML = makeOpts(auditCats);
    document.getElementById('auditStatus').innerHTML = makeStatusOpts(auditStats);
    // Atividades
    document.getElementById('ativCategoria').innerHTML = makeOpts(ativCats);
    document.getElementById('ativStatus').innerHTML = makeStatusOpts(ativStats);
    // Manutenção
    document.getElementById('mantCategoria').innerHTML = makeOpts(mantCats);
    document.getElementById('mantStatus').innerHTML = makeStatusOpts(mantStats);
    // Documentos
    document.getElementById('docCategoria').innerHTML = makeOpts(docCats);
    document.getElementById('docStatus').innerHTML = makeStatusOpts(docStats); 
    
    // Dispara a atualização das Subcategorias/Itens nos Modais
    // NOTE: Agora a Categoria e Subcategoria só são atualizadas se a Categoria for selecionada.
    // O Setor NÃO interfere na Categoria.
    onCategoryChange('audit');
    onCategoryChange('ativ');
    onCategoryChange('mant');
    onCategoryChange('doc');

    // --- FILTROS ---
    // Setores nos Filtros
    document.getElementById('fAuditSetor').innerHTML = makeFilterOpts(setores, "Setor: Todos"); // NOVO
    document.getElementById('fAtivSetor').innerHTML = makeFilterOpts(setores, "Setor: Todos"); // NOVO
    document.getElementById('fMantSetor').innerHTML = makeFilterOpts(setores, "Setor: Todos"); // NOVO
    document.getElementById('fDocSetor').innerHTML = makeFilterOpts(setores, "Setor: Todos"); // NOVO

    // Categorias e Status nos Filtros
    document.getElementById('fAuditCat').innerHTML = makeFilterOpts(auditCats, "Categoria: Todas");
    document.getElementById('fAuditStatus').innerHTML = makeStatusFilterOpts(auditStats, "Status: Todos");
    
    document.getElementById('fAtivCat').innerHTML = makeFilterOpts(ativCats, "Categoria: Todas");
    document.getElementById('fAtivStatus').innerHTML = makeStatusFilterOpts(ativStats, "Status: Todos");

    document.getElementById('fMantCat').innerHTML = makeFilterOpts(mantCats, "Categoria: Todas");
    document.getElementById('fMantStatus').innerHTML = makeStatusFilterOpts(mantStats, "Status: Todos");
    
    document.getElementById('fDocCat').innerHTML = makeFilterOpts(docCats, "Categoria: Todas"); 
    document.getElementById('fDocStatus').innerHTML = makeStatusFilterOpts(docStats, "Status: Todos"); 
    
    // Dispara a atualização dos filtros em cascata (Categoria -> Subcategoria/Item)
    onFilterCategoryChange('Audit');
    onFilterCategoryChange('Ativ');
    onFilterCategoryChange('Mant');
    onFilterCategoryChange('Doc');
}

// Funções auxiliares para obter prefixos de ID corretos
function getTabPrefix(tab) {
    if (tab === 'auditoria') return 'audit';
    if (tab === 'atividades') return 'ativ';
    if (tab === 'manutencao') return 'mant';
    if (tab === 'documentos') return 'doc';
    return '';
}

// Funções de atualização em cascata para MODAIS (Setor não interfere, mantido apenas para CategoryChange)
function onCategoryChange(prefix) {
    const catSelect = document.getElementById(`${prefix}Categoria`);
    let subcatSelect;
    let listKey;
    
    if (prefix === 'mant') {
        subcatSelect = document.getElementById(`${prefix}Item`);
        listKey = 'mantItens';
    } else {
        subcatSelect = document.getElementById(`${prefix}Sub`);
        listKey = `${prefix}Subcats`;
    }
    
    if (!subcatSelect) return; 

    const selectedCat = catSelect.value;
    const currentSubcat = subcatSelect.value; 
    
    // Se não houver categoria selecionada, limpa a subcategoria
    if (!selectedCat) {
        subcatSelect.innerHTML = `<option value="">${prefix === 'mant' ? 'Nenhum Item' : 'Nenhuma Subcategoria'}</option>`;
        return;
    }

    const subcats = masterLists[listKey][selectedCat] || [];
    
    subcatSelect.innerHTML = subcats.map(i => `<option value="${i}">${i}</option>`).join('') || 
                             `<option value="">${prefix === 'mant' ? 'Nenhum Item' : 'Nenhuma Subcategoria'}</option>`;

    // Tenta manter a seleção após a atualização
    if (subcats.includes(currentSubcat)) subcatSelect.value = currentSubcat;
}

// NOVO: Filtro de Setor (Setor NÃO afeta a Categoria no cadastro/filtro)
function onFilterSetorChange(prefix) {
    // Para Setor, basta renderizar os cards, pois ele é um filtro simples.
    // Se no futuro precisar de cascata Setor -> Categoria, a lógica deve ser implementada aqui.
    renderCards();
}

// Funções de atualização em cascata para FILTROS
function onFilterCategoryChange(prefix) {
    const catSelect = document.getElementById(`f${prefix}Cat`);
    let subcatSelect;
    let listKey;
    let label;
    
    if (prefix === 'Mant') {
        subcatSelect = document.getElementById(`f${prefix}Item`);
        listKey = 'mantItens';
        label = 'Item: Todos';
    } else {
        subcatSelect = document.getElementById(`f${prefix}Sub`);
        listKey = `${prefix.toLowerCase()}Subcats`;
        label = 'Subcategoria: Todas';
    }
    
    if (!subcatSelect) return; 

    const selectedCat = catSelect.value;
    const currentSubcat = subcatSelect.value;
    
    let subcats = [];

    if (selectedCat === "") {
        // Se a Categoria for "Todas", mostra todas as subcategorias em uso naquela aba
        let allSubcats = [];
        if (prefix === 'Audit') allSubcats = audits.map(i => i.subcategoria).filter(Boolean);
        else if (prefix === 'Ativ') allSubcats = activities.map(i => i.subcategoria).filter(Boolean);
        else if (prefix === 'Mant') allSubcats = maintenances.map(i => i.item).filter(Boolean);
        else if (prefix === 'Doc') allSubcats = documents.map(i => i.subcategoria).filter(Boolean);
        
        subcats = [...new Set(allSubcats)].sort();

    } else {
        // Se uma Categoria for selecionada, mostra as subcategorias mestras para aquela categoria
        subcats = masterLists[listKey][selectedCat] || [];
    }
    
    subcatSelect.innerHTML = `<option value="">${label}</option>` + subcats.map(i => `<option value="${i}">${i}</option>`).join('');

    // Tenta manter a seleção após a atualização
    if (subcats.includes(currentSubcat)) subcatSelect.value = currentSubcat;

    renderCards(); // Dispara renderização após filtro ser atualizado
}

// Função de cálculo para Manutenção e Documentos (Periodicidade)
function calculateNextDate(prefix = 'mant') {
    let ultima, intervaloId, proximaDisplayId, intervalValue;

    if (prefix === 'mant') {
        ultima = document.getElementById('mantUltima').value;
        intervaloId = 'mantIntervalo';
        proximaDisplayId = 'mantProxima';
        intervalValue = parseInt(document.getElementById(intervaloId).value) || 0;
    } else if (prefix === 'doc') {
        ultima = document.getElementById('docDataCriacao').value; // Usando Data Criação como base
        intervaloId = 'docIntervalo';
        proximaDisplayId = 'docProximaRevisao';
        intervalValue = parseInt(document.getElementById(intervaloId).value) || 0;
    } else {
        return;
    }
    
    if (ultima) {
        const next = new Date(ultima);
        next.setDate(next.getDate() + intervalValue);
        const nextStr = next.toISOString().split('T')[0];
        document.getElementById(proximaDisplayId).textContent = formatBR(nextStr);
    }
}

// --- TAB CONTROL ---
function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
    
    const tabId = 'tab' + tab.charAt(0).toUpperCase() + tab.slice(1);
    const btn = document.getElementById(tabId);
    if(btn) btn.classList.add('active');
    
    const titles = { 
        auditoria: 'Auditoria', 
        atividades: 'Gestão de Atividades', 
        manutencao: 'Manutenção',
        documentos: 'Documentos', 
        backup: 'Backup do Sistema'
    };
    const subtitles = { 
        auditoria: 'Planejamento e execução de auditorias', 
        atividades: 'Controle de tarefas, reuniões e projetos',
        manutencao: 'Controle preventivo de equipamentos',
        documentos: 'Gerenciamento e controle de revisões', 
        backup: 'Segurança dos dados'
    };
    
    document.getElementById('pageTitle').textContent = titles[tab];
    document.getElementById('pageSubtitle').textContent = subtitles[tab];
    
    const isBackup = tab === 'backup';
    document.getElementById('filtersBar').style.display = isBackup ? 'none' : 'flex';
    document.getElementById('cardsGrid').style.display = isBackup ? 'none' : 'grid';
    document.getElementById('addBtn').style.display = isBackup ? 'none' : 'flex';
    document.getElementById('backupContent').style.display = isBackup ? 'flex' : 'none';

    document.getElementById('filtersAuditoria').style.display = tab === 'auditoria' ? 'flex' : 'none';
    document.getElementById('filtersAtividades').style.display = tab === 'atividades' ? 'flex' : 'none';
    document.getElementById('filtersManutencao').style.display = tab === 'manutencao' ? 'flex' : 'none';
    document.getElementById('filtersDocumentos').style.display = tab === 'documentos' ? 'flex' : 'none'; 
    
    if(!isBackup) {
        clearFilters();
    }
}

document.getElementById('tabAuditoria').onclick = () => switchTab('auditoria');
document.getElementById('tabAtividades').onclick = () => switchTab('atividades');
document.getElementById('tabManutencao').onclick = () => switchTab('manutencao');
document.getElementById('tabDocumentos').onclick = () => switchTab('documentos'); 
document.getElementById('tabBackup').onclick = () => switchTab('backup');

// --- MODAL & FORM LOGIC ---
document.getElementById('addBtn').onclick = () => {
    // Seleciona o primeiro setor/categoria disponível se a lista não estiver vazia
    const defaultSetor = masterLists.setores[0] || ''; 
    const defaultAuditCat = masterLists.auditCategorias[0] || ''; 
    const defaultAtivCat = masterLists.ativCategorias[0] || ''; 
    const defaultMantCat = masterLists.mantCategorias[0] || ''; 
    const defaultDocCat = masterLists.docCategorias[0] || ''; 

    if (currentTab === 'auditoria') {
        editingAuditId = null;
        document.getElementById('auditTitulo').value = '';
        document.getElementById('auditDescricao').value = '';
        document.getElementById('auditDataPublicacao').value = today();
        document.getElementById('auditDataPrevisao').value = today();
        document.getElementById('auditResponsavel').value = ''; 
        document.getElementById('auditAnexos').innerHTML = '';
        document.getElementById('auditSetor').value = defaultSetor; // NOVO
        document.getElementById('auditCategoria').value = defaultAuditCat;
        onCategoryChange('audit');
        document.getElementById('modalAuditoria').style.display = 'flex';
    } else if (currentTab === 'atividades') {
        editingAtivId = null;
        document.getElementById('ativTitulo').value = '';
        document.getElementById('ativDescricao').value = '';
        document.getElementById('ativDataInicio').value = today();
        document.getElementById('ativDataConclusao').value = today();
        document.getElementById('ativResponsavel').value = ''; 
        document.getElementById('ativAnexos').innerHTML = '';
        document.getElementById('ativSetor').value = defaultSetor; // NOVO
        document.getElementById('ativCategoria').value = defaultAtivCat;
        onCategoryChange('ativ');
        document.getElementById('modalAtividades').style.display = 'flex';
    } else if (currentTab === 'manutencao') {
        editingMantId = null;
        document.getElementById('mantTitulo').value = '';
        document.getElementById('mantDescricao').value = '';
        document.getElementById('mantUltima').value = today();
        document.getElementById('mantIntervalo').value = 30;
        document.getElementById('mantResponsavelTecnico').value = ''; 
        document.getElementById('mantResponsavelManutencao').value = ''; 
        document.getElementById('mantAnexos').innerHTML = '';
        document.getElementById('mantSetor').value = defaultSetor; // NOVO
        document.getElementById('mantCategoria').value = defaultMantCat;
        onCategoryChange('mant');
        calculateNextDate('mant');
        document.getElementById('modalManutencao').style.display = 'flex';
    } else if (currentTab === 'documentos') { 
        editingDocId = null;
        document.getElementById('docTitulo').value = '';
        document.getElementById('docDescricao').value = '';
        document.getElementById('docDataCriacao').value = today();
        document.getElementById('docIntervalo').value = 365; // Valor padrão de 1 ano
        document.getElementById('docResponsavel').value = '';
        document.getElementById('docRevisor').value = '';
        document.getElementById('docFlagDias').value = 30;
        document.getElementById('docAnexos').innerHTML = '';
        document.getElementById('docSetor').value = defaultSetor; // NOVO
        document.getElementById('docCategoria').value = defaultDocCat;
        onCategoryChange('doc');
        calculateNextDate('doc');
        document.getElementById('modalDocumentos').style.display = 'flex';
    }
};


// SAVE FUNCTIONS
function saveAudit() {
    const item = {
        id: editingAuditId || Date.now(),
        titulo: document.getElementById('auditTitulo').value,
        descricao: document.getElementById('auditDescricao').value,
        setor: document.getElementById('auditSetor').value, // NOVO CAMPO
        categoria: document.getElementById('auditCategoria').value,
        subcategoria: document.getElementById('auditSub').value, 
        status: document.getElementById('auditStatus').value,
        dataPublicacao: document.getElementById('auditDataPublicacao').value,
        dataPrevisao: document.getElementById('auditDataPrevisao').value,
        responsavel: document.getElementById('auditResponsavel').value, 
        flagDias: +document.getElementById('auditFlagDias').value,
        anexos: getAnexos('audit')
    };
    if (editingAuditId) audits = audits.map(a => a.id === editingAuditId ? item : a);
    else audits.push(item);
    saveAll(); closeModal('modalAuditoria'); renderCards();
}

function saveAtividade() {
    const item = {
        id: editingAtivId || Date.now(),
        titulo: document.getElementById('ativTitulo').value,
        descricao: document.getElementById('ativDescricao').value,
        setor: document.getElementById('ativSetor').value, // NOVO CAMPO
        categoria: document.getElementById('ativCategoria').value,
        subcategoria: document.getElementById('ativSub').value, 
        status: document.getElementById('ativStatus').value,
        dataInicio: document.getElementById('ativDataInicio').value,
        dataConclusao: document.getElementById('ativDataConclusao').value,
        responsavel: document.getElementById('ativResponsavel').value, 
        flagDias: +document.getElementById('ativFlagDias').value,
        anexos: getAnexos('ativ')
    };
    if (editingAtivId) activities = activities.map(a => a.id === editingAtivId ? item : a);
    else activities.push(item);
    saveAll(); closeModal('modalAtividades'); renderCards();
}

function saveManutencao() {
    const ultima = document.getElementById('mantUltima').value;
    const intervalo = parseInt(document.getElementById('mantIntervalo').value);
    const nextDate = new Date(ultima);
    nextDate.setDate(nextDate.getDate() + intervalo);
    const item = {
        id: editingMantId || Date.now(),
        titulo: document.getElementById('mantTitulo').value,
        descricao: document.getElementById('mantDescricao').value,
        setor: document.getElementById('mantSetor').value, // NOVO CAMPO
        categoria: document.getElementById('mantCategoria').value,
        item: document.getElementById('mantItem').value, 
        ultima,
        intervalo,
        proxima: nextDate.toISOString().split('T')[0],
        responsavelTecnico: document.getElementById('mantResponsavelTecnico').value, 
        responsavelManutencao: document.getElementById('mantResponsavelManutencao').value, 
        status: document.getElementById('mantStatus').value,
        flagDias: +document.getElementById('mantFlagDias').value,
        anexos: getAnexos('mant')
    };
    if (editingMantId) maintenances = maintenances.map(m => m.id === editingMantId ? item : m);
    else maintenances.push(item);
    saveAll(); closeModal('modalManutencao'); renderCards();
}

function saveDocumento() { 
    const dataCriacao = document.getElementById('docDataCriacao').value;
    const docIntervalo = parseInt(document.getElementById('docIntervalo').value);
    const nextRevisao = new Date(dataCriacao);
    nextRevisao.setDate(nextRevisao.getDate() + docIntervalo);
    
    const item = {
        id: editingDocId || Date.now(),
        titulo: document.getElementById('docTitulo').value,
        descricao: document.getElementById('docDescricao').value,
        setor: document.getElementById('docSetor').value, // NOVO CAMPO
        categoria: document.getElementById('docCategoria').value,
        subcategoria: document.getElementById('docSub').value, 
        status: document.getElementById('docStatus').value,
        dataCriacao,
        docIntervalo, 
        dataProximaRevisao: nextRevisao.toISOString().split('T')[0], 
        responsavel: document.getElementById('docResponsavel').value,
        revisor: document.getElementById('docRevisor').value,
        flagDias: +document.getElementById('docFlagDias').value,
        anexos: getAnexos('doc')
    };
    if (editingDocId) documents = documents.map(d => d.id === editingDocId ? item : d);
    else documents.push(item);
    saveAll(); closeModal('modalDocumentos'); renderCards();
}

function editItem(id, tab) {
    if (tab === 'auditoria') {
        const item = audits.find(a => a.id === id);
        editingAuditId = id;
        document.getElementById('auditTitulo').value = item.titulo;
        document.getElementById('auditDescricao').value = item.descricao;
        document.getElementById('auditSetor').value = item.setor || ''; // NOVO
        document.getElementById('auditCategoria').value = item.categoria;
        onCategoryChange('audit'); 
        document.getElementById('auditSub').value = item.subcategoria || ''; 
        document.getElementById('auditStatus').value = item.status;
        document.getElementById('auditDataPublicacao').value = item.dataPublicacao;
        document.getElementById('auditDataPrevisao').value = item.dataPrevisao;
        document.getElementById('auditResponsavel').value = item.responsavel || ''; 
        document.getElementById('auditFlagDias').value = item.flagDias;
        restoreAnexos('audit', item.anexos);
        document.getElementById('modalAuditoria').style.display = 'flex';
    } else if (tab === 'atividades') {
        const item = activities.find(a => a.id === id);
        editingAtivId = id;
        document.getElementById('ativTitulo').value = item.titulo;
        document.getElementById('ativDescricao').value = item.descricao;
        document.getElementById('ativSetor').value = item.setor || ''; // NOVO
        document.getElementById('ativCategoria').value = item.categoria;
        onCategoryChange('ativ'); 
        document.getElementById('ativSub').value = item.subcategoria || ''; 
        document.getElementById('ativStatus').value = item.status;
        document.getElementById('ativDataInicio').value = item.dataInicio;
        document.getElementById('ativDataConclusao').value = item.dataConclusao;
        document.getElementById('ativResponsavel').value = item.responsavel || ''; 
        document.getElementById('ativFlagDias').value = item.flagDias;
        restoreAnexos('ativ', item.anexos);
        document.getElementById('modalAtividades').style.display = 'flex';
    } else if (tab === 'manutencao') {
        const item = maintenances.find(m => m.id === id);
        editingMantId = id;
        document.getElementById('mantTitulo').value = item.titulo;
        document.getElementById('mantDescricao').value = item.descricao;
        document.getElementById('mantSetor').value = item.setor || ''; // NOVO
        document.getElementById('mantCategoria').value = item.categoria;
        onCategoryChange('mant'); 
        document.getElementById('mantItem').value = item.item;
        document.getElementById('mantUltima').value = item.ultima;
        document.getElementById('mantIntervalo').value = item.intervalo;
        document.getElementById('mantResponsavelTecnico').value = item.responsavelTecnico || ''; 
        document.getElementById('mantResponsavelManutencao').value = item.responsavelManutencao || ''; 
        document.getElementById('mantStatus').value = item.status;
        document.getElementById('mantFlagDias').value = item.flagDias;
        calculateNextDate('mant');
        restoreAnexos('mant', item.anexos);
        document.getElementById('modalManutencao').style.display = 'flex';
    } else if (tab === 'documentos') { 
        const item = documents.find(d => d.id === id);
        editingDocId = id;
        document.getElementById('docTitulo').value = item.titulo;
        document.getElementById('docDescricao').value = item.descricao;
        document.getElementById('docSetor').value = item.setor || ''; // NOVO
        document.getElementById('docCategoria').value = item.categoria;
        onCategoryChange('doc'); 
        document.getElementById('docSub').value = item.subcategoria || ''; 
        document.getElementById('docStatus').value = item.status;
        document.getElementById('docDataCriacao').value = item.dataCriacao;
        document.getElementById('docIntervalo').value = item.docIntervalo; 
        document.getElementById('docResponsavel').value = item.responsavel || '';
        document.getElementById('docRevisor').value = item.revisor || '';
        document.getElementById('docFlagDias').value = item.flagDias;
        calculateNextDate('doc');
        restoreAnexos('doc', item.anexos);
        document.getElementById('modalDocumentos').style.display = 'flex';
    }
}

function deleteItem(id, tab) {
    if (!confirm('Deseja realmente excluir este registro?')) return;
    if (tab === 'auditoria') audits = audits.filter(a => a.id !== id);
    else if (tab === 'atividades') activities = activities.filter(a => a.id !== id);
    else if (tab === 'manutencao') maintenances = maintenances.filter(m => m.id !== id);
    else if (tab === 'documentos') documents = documents.filter(d => d.id !== id); 
    saveAll();
    renderCards();
}

// Anexos Logic
function addAnexo(prefix) {
    const container = document.getElementById(prefix + 'Anexos');
    const div = document.createElement('div');
    div.className = 'anexo-item';
    div.innerHTML = `
        <i class="fas fa-link"></i>
        <input placeholder="Título do arquivo" class="anexo-title">
        <input placeholder="Cole a URL aqui..." class="anexo-url">
        <i class="fas fa-times" style="cursor:pointer; color:var(--ind-red)" onclick="this.parentElement.remove()"></i>
    `;
    container.appendChild(div);
}
function getAnexos(prefix) {
    return [...document.querySelectorAll(`#${prefix}Anexos .anexo-item`)].map(row => ({
        titulo: row.querySelector('.anexo-title').value,
        url: row.querySelector('.anexo-url').value
    })).filter(a => a.url);
}
function restoreAnexos(prefix, list) {
    const container = document.getElementById(prefix + 'Anexos');
    container.innerHTML = '';
    (list || []).forEach(a => {
        addAnexo(prefix);
        const row = container.lastChild;
        row.querySelector('.anexo-title').value = a.titulo;
        row.querySelector('.anexo-url').value = a.url;
    });
}

// View Modal
function openView(id, tab) {
    let item, statusList;
    if (tab === 'auditoria') { item = audits.find(i => i.id === id); statusList = masterLists.auditStatus; }
    else if (tab === 'atividades') { item = activities.find(i => i.id === id); statusList = masterLists.ativStatus; }
    else if (tab === 'manutencao') { item = maintenances.find(i => i.id === id); statusList = masterLists.mantStatus; }
    else if (tab === 'documentos') { item = documents.find(i => i.id === id); statusList = masterLists.docStatus; } 

    if (!item) return;

    const statusObj = (statusList || []).find(s => s.name === item.status) || { color: 'default' };
    const statusColorVar = colorMap[statusObj.color] || colorMap['default'];
    
    // Adiciona Subcategoria/Item (Manutenção) na exibição
    const subcatOrItemLabel = tab === 'manutencao' ? 'Equipamento' : 'Subcategoria';
    const subcatOrItemValue = tab === 'manutencao' ? item.item : item.subcategoria;


    let detailsGrid = '';
    if (tab === 'auditoria') {
        detailsGrid = `
            <div class="view-item"><label>Setor</label><div>${item.setor || 'ND'}</div></div>
            <div class="view-item"><label>Categoria</label><div>${item.categoria}</div></div>
            <div class="view-item"><label>${subcatOrItemLabel}</label><div>${subcatOrItemValue || 'ND'}</div></div>
            <div class="view-item"><label>Responsável</label><div>${item.responsavel || 'ND'}</div></div>
            <div class="view-item"><label>Publicação</label><div>${formatBR(item.dataPublicacao)}</div></div>
            <div class="view-item"><label>Previsão</label><div>${formatBR(item.dataPrevisao)}</div></div>
            <div class="view-item"><label>Alerta</label><div>${item.flagDias} dias antes</div></div>
        `;
    } else if (tab === 'atividades') {
        detailsGrid = `
            <div class="view-item"><label>Setor</label><div>${item.setor || 'ND'}</div></div>
            <div class="view-item"><label>Categoria</label><div>${item.categoria}</div></div>
            <div class="view-item"><label>${subcatOrItemLabel}</label><div>${subcatOrItemValue || 'ND'}</div></div>
            <div class="view-item"><label>Responsável</label><div>${item.responsavel || 'ND'}</div></div>
            <div class="view-item"><label>Data Início</label><div>${formatBR(item.dataInicio)}</div></div>
            <div class="view-item"><label>Data Conclusão</label><div>${formatBR(item.dataConclusao)}</div></div>
            <div class="view-item"><label>Alerta</label><div>${item.flagDias} dias antes</div></div>
        `;
    } else if (tab === 'manutencao') {
        detailsGrid = `
            <div class="view-item"><label>Setor</label><div>${item.setor || 'ND'}</div></div>
            <div class="view-item"><label>Categoria</label><div>${item.categoria}</div></div>
            <div class="view-item"><label>Equipamento</label><div>${item.item}</div></div>
            <div class="view-item"><label>Periodicidade</label><div>${item.intervalo} dias</div></div>
            <div class="view-item"><label>Última Manutenção</label><div>${formatBR(item.ultima)}</div></div>
            <div class="view-item"><label>Próxima Manutenção</label><div>${formatBR(item.proxima)}</div></div>
            <div class="view-item"><label>Responsável Técnico</label><div>${item.responsavelTecnico || 'ND'}</div></div>
            <div class="view-item"><label>Responsável pela Manutenção</label><div>${item.responsavelManutencao || 'ND'}</div></div>
            <div class="view-item"><label>Alerta</label><div>${item.flagDias} dias antes</div></div>
        `;
    } else if (tab === 'documentos') { 
        detailsGrid = `
            <div class="view-item"><label>Setor</label><div>${item.setor || 'ND'}</div></div>
            <div class="view-item"><label>Categoria</label><div>${item.categoria}</div></div>
            <div class="view-item"><label>${subcatOrItemLabel}</label><div>${subcatOrItemValue || 'ND'}</div></div>
            <div class="view-item"><label>Periodicidade</label><div>${item.docIntervalo} dias</div></div>
            <div class="view-item"><label>Responsável</label><div>${item.responsavel || 'ND'}</div></div>
            <div class="view-item"><label>Revisor</label><div>${item.revisor || 'ND'}</div></div>
            <div class="view-item"><label>Data Criação</label><div>${formatBR(item.dataCriacao)}</div></div>
            <div class="view-item"><label>Próx. Revisão</label><div>${formatBR(item.dataProximaRevisao)}</div></div>
            <div class="view-item"><label>Alerta</label><div>${item.flagDias} dias antes</div></div>
        `;
    }

    const anexosHtml = (item.anexos || []).map(a => 
        `<a href="${a.url}" target="_blank" class="file-chip"><i class="fas fa-external-link-alt"></i> ${a.titulo || 'Anexo'}</a>`
    ).join('');

    const html = `
        <div class="view-header">
            <h2 style="margin:0; color:var(--primary)">${item.titulo}</h2>
            <span class="view-status" style="background-color:${statusColorVar}">${item.status}</span>
        </div>
        <div class="view-grid">
            ${detailsGrid}
        </div>
        <div>
            <h4 style="margin:0 0 8px; color:#6b7280; font-size:12px; text-transform:uppercase">Descrição Detalhada</h4>
            <div class="view-desc">${item.descricao || 'Sem descrição.'}</div>
        </div>
        ${anexosHtml ? `<div class="view-files"><h4>Anexos</h4>${anexosHtml}</div>` : ''}
    `;
    
    document.getElementById('viewContent').innerHTML = html;
    document.getElementById('viewModal').style.display = 'flex';
}

// List Manager & Color Selection
function openListManager(genericKey) {
    let isStatus = false;
    let listName;
    
    if (genericKey === 'setores') { // NOVO PONTO DE ENTRADA
        currentListKey = 'setores';
        listName = 'SETORES';
    } else if (genericKey === 'categorias') {
        if(currentTab === 'auditoria') currentListKey = 'auditCategorias';
        else if(currentTab === 'atividades') currentListKey = 'ativCategorias';
        else if(currentTab === 'manutencao') currentListKey = 'mantCategorias';
        else currentListKey = 'docCategorias'; 
        listName = 'CATEGORIA';
    } else if (genericKey === 'subcategorias' || genericKey === 'itens') { 
        
        const prefix = getTabPrefix(currentTab); 
        const catSelect = document.getElementById(`${prefix}Categoria`);
        
        if (!catSelect) { 
             alert(`Elemento de Categoria (${prefix}Categoria) não encontrado. Verifique se você abriu o modal correspondente à aba ativa.`); 
             return; 
        }

        const cat = catSelect.value;
        
        if (!cat) { alert("Selecione uma Categoria antes de gerenciar Subcategorias/Itens."); return; }
        
        let subcatMapKey;
        if(currentTab === 'auditoria') subcatMapKey = 'auditSubcats';
        else if(currentTab === 'atividades') subcatMapKey = 'ativSubcats';
        else if(currentTab === 'manutencao') subcatMapKey = 'mantItens';
        else subcatMapKey = 'docSubcats';
        
        currentListKey = `${subcatMapKey}_${cat}`; // Chave temporária para o mapa
        listName = `SUBCATEGORIAS / ITENS DE: ${cat}`;
        
    } else if (genericKey === 'status') {
        if(currentTab === 'auditoria') currentListKey = 'auditStatus';
        else if(currentTab === 'atividades') currentListKey = 'ativStatus';
        else if(currentTab === 'manutencao') currentListKey = 'mantStatus';
        else currentListKey = 'docStatus';
        isStatus = true;
        listName = 'STATUS';
    } else {
        currentListKey = genericKey; 
        listName = genericKey.toUpperCase();
    }
    
    document.getElementById('listTitle').textContent = `Gerenciar: ${listName}`;
    const body = document.getElementById('listBody');
    body.innerHTML = '';

    if(isStatus) {
        document.getElementById('colorPickerContainer').style.display = 'block';
        selectColor('default', document.querySelector('.bg-default')); 
    } else {
        document.getElementById('colorPickerContainer').style.display = 'none';
    }

    let listToRender;
    let baseKey = currentListKey.split('_')[0]; // Para subcategorias

    if (currentListKey.includes('_')) { // Gerenciando Subcategorias/Itens
        const cat = currentListKey.split('_')[1];
        // Tenta buscar a lista dentro do mapa de objetos, inicializando se necessário
        masterLists[baseKey] = masterLists[baseKey] || {}; 
        listToRender = masterLists[baseKey][cat] || [];
    } else {
        listToRender = masterLists[currentListKey] || [];
    }
    
    listToRender.forEach(val => {
        let displayHtml = '', itemVal = '';
        if (typeof val === 'object') {
            const colorVar = colorMap[val.color] || colorMap['default'];
            displayHtml = `<span class="color-dot" style="background-color:${colorVar}"></span>${val.name}`;
            itemVal = val.name; 
        } else {
            displayHtml = val;
            itemVal = val;
        }

        body.innerHTML += `<tr>
            <td>${displayHtml}</td>
            <td class="remove" onclick="removeFromList('${currentListKey}','${itemVal}')"><i class="fas fa-trash"></i></td>
        </tr>`;
    });
    
    const input = document.getElementById('newListItem');
    input.value = '';
    input.onkeydown = (e) => { if(e.key === 'Enter') addToList(); };
    
    document.getElementById('modalListManager').style.display = 'flex';
}

function selectColor(color, el) {
    selectedColorTemp = color;
    document.querySelectorAll('.color-option').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
}

function addToList() {
    const val = document.getElementById('newListItem').value.trim();
    if (!val) return;
    
    const isStatus = currentListKey.toLowerCase().includes('status');
    const isSubcat = currentListKey.includes('_'); 
    
    let list;
    if (isSubcat) {
        const [baseKey, cat] = currentListKey.split('_');
        masterLists[baseKey][cat] = masterLists[baseKey][cat] || []; // Inicializa se for nulo
        list = masterLists[baseKey][cat];
    } else {
        list = masterLists[currentListKey];
    }

    if (isStatus) {
        if(list.some(s => s.name === val)) return;
        list.push({ name: val, color: selectedColorTemp });
    } else {
        if(list.includes(val)) return;
        list.push(val);
    }

    // Ordenação
    list.sort((a,b) => (typeof a === 'object' ? a.name : a).localeCompare(typeof b === 'object' ? b.name : b));
    
    saveAll(); populateSelects();
    
    let genericTag;
    if(isSubcat) genericTag = 'subcategorias';
    else if(isStatus) genericTag = 'status';
    else if(currentListKey === 'setores') genericTag = 'setores'; // NOVO
    else genericTag = 'categorias';
    
    openListManager(genericTag);
}

function removeFromList(key, val) {
    const isStatus = key.toLowerCase().includes('status');
    const isSubcat = key.includes('_');
    
    let list;
    if (isSubcat) {
        const [baseKey, cat] = key.split('_');
        list = masterLists[baseKey][cat];
        if (isStatus) list = list.filter(s => s.name !== val);
        else list = list.filter(i => i !== val);
        masterLists[baseKey][cat] = list; // Atualiza o mapa
    } else {
        list = masterLists[key];
        if (isStatus) masterLists[key] = list.filter(s => s.name !== val);
        else masterLists[key] = list.filter(i => i !== val);
    }

    saveAll(); populateSelects();
    
    let genericTag;
    if(isSubcat) genericTag = 'subcategorias';
    else if(isStatus) genericTag = 'status';
    else if(key === 'setores') genericTag = 'setores'; // NOVO
    else genericTag = 'categorias';
    openListManager(genericTag);
}
// --- FUNÇÕES DE BACKUP LOCAL (ARQUIVO) ---

function exportLocalData() {
    const data = {
        audits,
        activities,
        maintenances,
        documents, 
        masterLists,
        exportDate: new Date().toISOString(),
        source: "local_export"
    };
    
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "Auditoria_Lamic_" + today() + ".json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}

function importLocalData(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = async function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            // Validação básica
            if (data.audits && data.masterLists) {
                if(confirm("ATENÇÃO: Isso substituirá os dados atuais e atualizará a nuvem. Deseja continuar?")) {
                    
                    // Atualiza variáveis em memória
                    audits = data.audits || [];
                    activities = data.activities || [];
                    maintenances = data.maintenances || [];
                    documents = data.documents || []; 
                    
                    // Tratamento de compatibilidade para masterLists
                    masterLists = { ...defaultMasterLists, ...data.masterLists };
                    if (Array.isArray(masterLists.mantItens)) {
                        masterLists.mantItens = defaultMasterLists.mantItens; 
                    }


                    // Salva na nuvem para persistir a importação
                    await saveAll(false); 
                    
                    alert("Backup local restaurado e sincronizado com a nuvem com sucesso!");
                    
                    // Recarrega interface
                    populateSelects();
                    renderCards();
                    input.value = ''; // Limpa o input para permitir re-upload do mesmo arquivo se necessário
                }
            } else {
                alert("O arquivo selecionado não é um backup válido deste sistema.");
            }
        } catch (err) {
            alert("Erro ao ler o arquivo: " + err.message);
        }
    };
    reader.readAsText(file);
}

function closeModal(id) { document.getElementById(id).style.display = 'none'; }

// Inicialização (garante que os selects sejam preenchidos ao carregar a página)
document.addEventListener('DOMContentLoaded', () => {
    // A inicialização principal dos dados é feita em checkLogin, após autenticação.
    // Mas as chamadas abaixo garantem que as estruturas de data/dropdowns existam, mesmo que vazias inicialmente.
    populateYearSelects();
    populateSelects();
});

document.onkeydown = function(event) {
    if (
        event.keyCode === 123 ||  // F12
        ctrlShiftKey(event, 'I') ||  // Ctrl + Shift + I
        ctrlShiftKey(event, 'J') ||  // Ctrl + Shift + J
        ctrlShiftKey(event, 'C') ||  // Ctrl + Shift + C
        (event.ctrlKey && event.keyCode === 'U'.charCodeAt(0)) ||  // Ctrl + U
        (event.ctrlKey && event.keyCode === 'S'.charCodeAt(0))  // Ctrl + S
    ) {
        event.preventDefault();
        return false;
    }
};
        document.addEventListener('contextmenu', function(evento) {
                // Previne o comportamento padrão (abre o menu)
                evento.preventDefault();
            });

</script>
</body>
</html>